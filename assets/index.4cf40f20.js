import{l as T,f as $,a as O,b as U,c as F,d as M,e as j,g as q,j as u,h as s,F as m,B as h,i as D,k as y,m as W,r as p,t as C,T as Q,R as H}from"./vendor.43620a55.js";const G=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}};G();T.add($,O,U,F,M,j,q);const V=e=>e.replace(/[\x00-\x1F\x7F/\\<>:;"|=,.?*[\] ]+/g,"_").toLowerCase()+".csv";function E(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(window.location.search);return n===null?"":decodeURIComponent(n[1].replace(/\+/g," "))}function X(e){let t=!0;for(let n=0;n<e.length-1;n++)if(e[n]>e[n+1]){t=!1;break}return t}function I(e){return e%2==0}function K(e){const t=Math.floor(e/1e3%60);return Math.floor(e/1e3/60).toString()+":"+t.toString().padStart(2,"0")}function Y(e){return'"'+String(e).replace(/"/g,'""')+'"'}function J(){return u("div",{id:"spotifyErrorMessage",className:"lead",children:[s("p",{children:s(m,{icon:["fas","bolt"],style:{fontSize:"50px",marginBottom:"20px"}})}),s("p",{children:"Oops, Exportify has encountered an unexpected error (5XX) while using the Spotify API. This kind of error is due to a problem on Spotify's side, and although it's rare, unfortunately all we can do is retry later."}),u("p",{style:{marginTop:"50px"},children:["Keep an eye on the"," ",s("a",{target:"_blank",rel:"noreferrer",href:"https://status.spotify.dev/",children:"Spotify Web API Status page"})," ","to see if there are any known problems right now, and then"," ",s("a",{rel:"noreferrer",href:"?",children:"retry"}),"."]})]})}function Z(){return u("form",{className:"login-container",onSubmit:e=>{e.preventDefault(),ee(e)},children:[s("input",{id:"clientId",required:!0,minLength:32,maxLength:32,type:"password",placeholder:"Enter client id..."}),u(h,{type:"submit",variant:"outline-secondary",size:"lg",children:[s(m,{icon:["far","check-circle"],size:"sm"})," Get Started"]})]})}function ee(e){const{clientId:{value:t}}=e.target.elements,n=E("change_user")!=="";window.location.href="https://accounts.spotify.com/authorize?client_id="+t+"&redirect_uri="+encodeURIComponent([window.location.protocol,"//",window.location.host,window.location.pathname].join(""))+"&scope=playlist-read-private%20playlist-read-collaborative%20user-library-read%20playlist-modify-private%20playlist-modify-public&response_type=token&show_dialog="+n}function te(){return s(h,{id:"logoutButton",type:"submit",variant:"link",size:"lg",onClick:()=>{window.location.href=`${window.location.href.split("#")[0]}?change_user=true`},title:"Change user",children:s(m,{icon:["fas","sign-out-alt"],size:"lg"})})}const R=1e3,se=2,k=new D({maxConcurrent:1,minTime:0}),_=k.wrap(function(e,t){return y.get(e,{headers:{Authorization:"Bearer "+t}})});function b(e){if(e.isAxiosError){if(e.request.status===401){window.location.href=window.location.href.split("#")[0];return}else if(e.request.status>=500&&e.request.status<600){window.location.href=`${window.location.href.split("#")[0]}?spotify_error=true`;return}}throw e}k.on("failed",async(e,t)=>{if(e.response.status===429&&t.retryCount<se)return(e.response.headers["retry-after"]||1)*1e3+R;if(e.response.status!==401&&e.response.status!==429&&t.retryCount===0)return R});const w=20;async function ne(e,t){const n=async(i,l)=>{const c=`https://api.spotify.com/v1/users/${t}/playlists?offset=${i}&limit=${l-i}`;return(await _(c,e)).data},{items:o,total:r}=await n(0,w);let a=o;for(let i=w;i<r;i=i+w){const{items:l}=await n(i,i+w);a=[...a,...l]}return a}async function S(e,t){const n=[],o=t.tracks.limit||100;for(let i=0;i<t.tracks.total;i=i+o)n.push(`${t.tracks.href.split("?")[0]}?offset=${i}&limit=${o}`);const r=n.map(i=>_(i,e));return(await Promise.all(r)).flatMap(i=>i.data.items.filter(l=>l.track))}function L(e){const t=e.track_number.toString().padStart(2,"0"),n=P(e.artists[0].name),o=P(e.album.name),r=e.album.release_date===null?"0000-00-00":e.album.release_date;return n+r+o+t}function P(e){let t=e;return e.toLowerCase().startsWith("a ")?t=e.substring(2):e.toLowerCase().startsWith("the ")?t=e.substring(4):e.startsWith("$")&&(t=e.replace("$","S")),t.toLowerCase()}async function re(e,t){async function n(i,l,c){const d=[...i],f=await o(d,l,c);l<f-1&&await n(d,l,f-1),f<c&&await n(d,f,c)}async function o(i,l,c){const d=i[Math.floor((l+c)/2)];for(;l<=c;){for(;i[l]<d;)l++;for(;i[c]>d;)c--;l<=c&&(await r(i,l,c),l++,c--)}return l}async function r(i,l,c){const d=i[l];i[l]=i[c],i[c]=d,await y.put(`https://api.spotify.com/v1/playlists/${t.id}/tracks`,{range_start:l,insert_before:c+1},{headers:{Authorization:"Bearer "+e}}),await y.put(`https://api.spotify.com/v1/playlists/${t.id}/tracks`,{range_start:c-1>0?c-1:0,insert_before:l},{headers:{Authorization:"Bearer "+e}})}const a=await S(e,t).then(i=>i.map(({track:l})=>L(l)));return X(a)?"is-sorted":(await n(a,0,a.length-1),"sorted")}async function ie(e,t){const n=await S(e,t).then(r=>r.map(({track:a})=>L(a))),o=[];for(let r=n.length-1;r>0;r--){const a=n[r];if(n.slice(r-100>0?r-100:0,r).some(i=>a<i))o.push(a);else break}if(o.length===0)return 0;for(const r of o){const a=n.findIndex(i=>i>r);await y.put(`https://api.spotify.com/v1/playlists/${t.id}/tracks`,{range_start:n.length-1,insert_before:a},{headers:{Authorization:"Bearer "+e}}),n.splice(a,0,r),n.splice(-1,1)}return o.length}function ae(e){return[["Track URI","Track Name","Artist Name(s)","Album Name","Album Artist Name(s)","Album Release Date","Album Image URL","Album URI","Disc Number","Track Number","Track Duration (ms)"],...oe(e).filter(n=>n.uri).map(n=>n.item)].map(n=>n.map(Y).join(",")+`
`).join("")}function oe(e){return e.map(({track:t})=>({uri:t.uri,item:[t.uri.startsWith("spotify:local")?decodeURIComponent(t.uri.replaceAll("+"," ")):t.uri,t.name,t.artists.map(n=>String(n.name).replace(/,/g,"\\,")).join(", "),t.album.name,t.album.artists.map(n=>String(n.name).replace(/,/g,"\\,")).join(", "),t.album.release_date==null?"":t.album.release_date,t.album.images[0]==null?"":t.album.images[0].url,t.album.uri==null?"":t.album.uri,t.disc_number,t.track_number,K(t.duration_ms)]}))}async function le(e,t){const n=await S(e,t),o=new Blob([ae(n)],{type:"text/csv;charset=utf-8"});W.exports.saveAs(o,V(t.name))}function v(){return s("div",{className:"loader",children:s("div",{className:"loader__content"})})}const z="Albums,Anime,Games,Edge_2000,Final_Fantasy_OST,Release_Radar,Solitude_bois_for_lyfe".replaceAll("_"," ").split(",")||[];function ce({playlist:e,accessToken:t,index:n}){var N;const[o,r]=p.exports.useState(!1),a=()=>{r(!0),re(t,e).then(g=>C.success(g!=="is-sorted"?"Sorted all items!":"Playlist already sorted!",{position:"bottom-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!1,progress:void 0})).catch(b).finally(()=>r(!1))},[i,l]=p.exports.useState(!1),c=()=>{l(!0),ie(t,e).then(g=>C.success(g?`Sorted ${g} items!`:"Playlist already sorted!",{position:"bottom-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!1,progress:void 0})).catch(b).finally(()=>l(!1))},[d,f]=p.exports.useState(!1),B=()=>{f(!0),le(t,e).catch(b).finally(()=>f(!1))},x=d||o||i;return e.uri==null?u("tr",{className:I(n)?"":"alt-color",children:[s("td",{children:"\xA0"}),s("td",{children:e.name}),s("td",{colSpan:2,children:"This playlist is not supported"}),s("td",{children:"\xA0"}),s("td",{children:"\xA0"})]},e.name):u("tr",{className:I(n)?"":"alt-color",children:[s("td",{children:s("img",{alt:"cover",src:(N=e==null?void 0:e.images)==null?void 0:N[0].url})}),s("td",{className:"align-middle",children:s("a",{href:e.uri,children:e.name})}),s("td",{className:"align-middle",children:e.tracks.total}),s("td",{className:"text-center align-middle",children:z.includes(e.name)?null:u(h,{type:"submit",variant:"primary",onClick:a,className:"text-nowrap text-center button-flex",disabled:x,children:[o?s(v,{}):s(m,{icon:["fas","sort"],size:"sm"})," ","Quicksort"]})}),s("td",{className:"text-center align-middle",children:z.includes(e.name)?null:u(h,{type:"submit",variant:"primary",onClick:c,className:"text-nowrap text-center button-flex",disabled:x,children:[i?s(v,{}):s(m,{icon:["fas","sort-amount-up-alt"],size:"sm"})," ","Sort Last"]})}),s("td",{className:"text-center align-middle",children:u(h,{type:"submit",variant:"primary",onClick:B,className:"text-nowrap text-center button-flex",disabled:x,children:[d?s(v,{}):s(m,{icon:["fas","download"],size:"sm"})," ","Export"]})})]},e.uri)}function ue({accessToken:e}){const[t,n]=p.exports.useState(void 0);return p.exports.useEffect(()=>{(async function(){try{const{data:o}=await _("https://api.spotify.com/v1/me",e),r=await ne(e,o.id),a=document.getElementById("subtitle");n(r),a.textContent=`${r.length} playlists for ${o.id}`}catch(o){b(o)}})()},[e]),t?s("div",{id:"playlists",children:u("table",{className:"table table-hover table-sm",children:[s("thead",{children:u("tr",{children:[s("th",{style:{width:"100px"}}),s("th",{children:"Name"}),s("th",{children:"Tracks"}),s("th",{style:{width:"130px"}}),s("th",{style:{width:"130px"}}),s("th",{style:{width:"130px",textAlign:"right",paddingRight:"15px"},children:"Actions"})]})}),s("tbody",{children:t.map((o,r)=>s(ce,{playlist:o,index:r,accessToken:e},o.id))})]})}):s("div",{className:"spinner"})}function A({children:e,logoutElement:t=null}){return u("div",{className:"App container",children:[u("header",{className:"App-header",children:[t,u("h1",{children:[s(m,{icon:["fab","spotify"],color:"#1ed760",size:"sm"})," ","Hatlaron's Exportify"]}),s("p",{id:"subtitle",className:"lead text-secondary",children:"Export and sort your Spotify playlists."})]}),e,s(Q,{theme:"dark"})]})}function de(){const e=new URLSearchParams(window.location.hash.substring(1));return E("spotify_error")!==""?s(A,{children:s(J,{})}):e.has("access_token")?s(A,{logoutElement:s(te,{}),children:s(ue,{accessToken:e.get("access_token")})}):s(A,{children:s(Z,{})})}H.render(s(p.exports.StrictMode,{children:s(de,{})}),document.getElementById("root"));
