var v=Object.defineProperty;var D=(s,t,e)=>t in s?v(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var l=(s,t,e)=>(D(s,typeof t!="symbol"?t+"":t,e),e);import{l as R,_ as z,f as B,a as M,b as $,c as U,d as F,e as q,g as j,h as G,i as O,j as Z,k as Q,m as Y,n as c,o as a,B as m,F as u,p as W,q as f,r as H,s as y,R as K,t as X}from"./vendor.8dbe3e76.js";const V=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}};V();R.add(z,B,M,$,U,F,q,j,G,O,Z,Q,Y);function x(s){s=s.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const t=new RegExp("[\\?&]"+s+"=([^&#]*)"),e=t.exec(window.location.search);return e===null?"":decodeURIComponent(e[1].replace(/\+/g," "))}function J(){return c("form",{className:"login-container",onSubmit:s=>{s.preventDefault(),tt(s)},children:[a("input",{id:"clientId",required:!0,minLength:32,maxLength:32,type:"password",placeholder:"Enter client id..."}),c(m,{type:"submit",variant:"outline-secondary",size:"lg",children:[a(u,{icon:["far","check-circle"],size:"sm"})," Get Started"]})]})}function tt(s){const{clientId:{value:t}}=s.target.elements,e=x("change_user")!=="";window.location.href="https://accounts.spotify.com/authorize?client_id="+t+"&redirect_uri="+encodeURIComponent([window.location.protocol,"//",window.location.host,window.location.pathname].join(""))+"&scope=playlist-read-private%20playlist-read-collaborative%20user-library-read%20playlist-modify-private%20playlist-modify-public&response_type=token&show_dialog="+e}const _=1e3,et=2,A=new W({maxConcurrent:1,minTime:0}),k=A.wrap(function(s,t){return f.get(s,{headers:{Authorization:"Bearer "+t}})});function h(s){if(s.isAxiosError){if(s.request.status===401){window.location.href=window.location.href.split("#")[0];return}else if(s.request.status>=500&&s.request.status<600){window.location.href=`${window.location.href.split("#")[0]}?spotify_error=true`;return}}throw s}A.on("failed",async(s,t)=>{if(s.response.status===429&&t.retryCount<et)return(s.response.headers["retry-after"]||1)*1e3+_;if(s.response.status!==401&&s.response.status!==429&&t.retryCount===0)return _});class st{constructor(t,e){l(this,"PLAYLIST_LIMIT",50);l(this,"SEARCH_LIMIT",20);l(this,"userId");l(this,"accessToken");l(this,"data");l(this,"dataInitialized",!1);this.accessToken=t,this.userId=e,this.data=[]}async total(){return this.dataInitialized||await this.loadSlice(),this.data.length}async slice(t,e){return await this.loadSlice(t,e),this.data.slice(t,e)}async all(){return await this.loadAll(),this.data}async loadAll(){await this.loadSlice();for(let t=this.PLAYLIST_LIMIT;t<this.data.length;t=t+this.PLAYLIST_LIMIT)await this.loadSlice(t,t+this.PLAYLIST_LIMIT)}async loadSlice(t=0,e=t+this.PLAYLIST_LIMIT){if(this.dataInitialized){const o=this.data.slice(t,e);if(o.filter(d=>!d).length===0)return o}const i=`https://api.spotify.com/v1/users/${this.userId}/playlists?offset=${t}&limit=${e-t}`,n=(await k(i,this.accessToken)).data;this.dataInitialized||(this.data=Array(n.total).fill(null),this.dataInitialized=!0),this.data.splice(t,n.items.length,...n.items)}}class at{constructor(t){l(this,"accessToken");this.accessToken=t}}class S extends at{constructor(t,e){super(t);l(this,"playlist");l(this,"playlistItems",[]);this.playlist=e}dataLabels(){return["Track URI","Track Name","Artist URI(s)","Artist Name(s)","Album URI","Album Name","Album Artist URI(s)","Album Artist Name(s)","Album Release Date","Album Image URL","Disc Number","Track Number","Track Duration (ms)","Track Preview URL","Explicit","Popularity"]}async trackItems(){return await this.getPlaylistItems(),this.playlistItems}async data(){return await this.getPlaylistItems(),new Map(this.playlistItems.map(t=>[t.track.uri,[t.track.uri,t.track.name,t.track.artists.map(e=>e.uri).join(", "),t.track.artists.map(e=>String(e.name).replace(/,/g,"\\,")).join(", "),t.track.album.uri==null?"":t.track.album.uri,t.track.album.name,t.track.album.artists.map(e=>e.uri).join(", "),t.track.album.artists.map(e=>String(e.name).replace(/,/g,"\\,")).join(", "),t.track.album.release_date==null?"":t.track.album.release_date,t.track.album.images[0]==null?"":t.track.album.images[0].url,t.track.disc_number,t.track.track_number,t.track.duration_ms,t.track.preview_url==null?"":t.track.preview_url,t.track.explicit,t.track.popularity]]))}async getPlaylistItems(){if(this.playlistItems.length>0)return this.playlistItems;const t=[],e=this.playlist.tracks.limit||100;for(let n=0;n<this.playlist.tracks.total;n=n+e)t.push(`${this.playlist.tracks.href.split("?")[0]}?offset=${n}&limit=${e}`);const i=t.map(n=>k(n,this.accessToken)),r=await Promise.all(i);this.playlistItems=r.flatMap(n=>n.data.items.filter(o=>o.track))}}class it{constructor(t,e){l(this,"playlist");l(this,"trackItems");l(this,"columnNames");l(this,"lineData");l(this,"lineTrackUris");l(this,"lineTrackData");this.playlist=t,this.trackItems=e,this.columnNames=["Added By","Added At"],this.lineData=new Map,this.lineTrackUris=e.map(i=>i.track.uri),this.lineTrackData=e.map(i=>[i.added_by==null?"":i.added_by.uri,i.added_at])}async addData(t,e=!1){e?this.columnNames.unshift(...t.dataLabels()):this.columnNames.push(...t.dataLabels());const i=await t.data();this.lineTrackUris.forEach((r,n)=>{i.has(r)&&(e?this.lineTrackData[n].unshift(...i.get(r)):this.lineTrackData[n].push(...i.get(r)))})}content(){let t="";return t+=this.columnNames.map(this.sanitize).join()+`
`,this.lineTrackData.forEach(e=>{t+=e.map(this.sanitize).join(",")+`
`}),t}sanitize(t){return'"'+String(t).replace(/"/g,'""')+'"'}}class rt{constructor(t,e,i){l(this,"accessToken");l(this,"playlist");l(this,"setIsLoading");this.accessToken=t,this.playlist=e,this.setIsLoading=i}async export(){return this.setIsLoading(!0),this.csvData().then(t=>{const e=new Blob([t],{type:"text/csv;charset=utf-8"});H.exports.saveAs(e,this.fileName()),this.setIsLoading(!1)})}async csvData(){const t=new S(this.accessToken,this.playlist),e=await t.trackItems(),i=new it(this.playlist,e);return await i.addData(t,!0),i.content()}fileName(){return this.playlist.name.replace(/[\x00-\x1F\x7F/\\<>:;"|=,.?*[\] ]+/g,"_").toLowerCase()+".csv"}}class T{constructor(t,e,i){l(this,"accessToken");l(this,"playlist");l(this,"setIsLoading");l(this,"snapshotId");this.accessToken=t,this.playlist=e,this.setIsLoading=i}async sort(t){const e=new S(this.accessToken,this.playlist);this.setIsLoading(!0);let r=(await e.trackItems()).map(({track:n})=>({trackNumber:n.track_number.toString().padStart(2,"0"),artist:L(n.artists[0].name),albumName:L(n.album.name),releaseDate:n.album.release_date===null?"0000-00-00":n.album.release_date})).map(nt);if(t){const n=[];for(let o=r.length-1;o>0;o--){const d=r[o];if(r.slice(o-100>0?o-100:0,o).some(p=>d<p))n.push(d);else break}for(const o of n){const d=r.findIndex(g=>g>o),{data:{snapshot_id:p}}=await f.put(`https://api.spotify.com/v1/playlists/${this.playlist.id}/tracks`,{range_start:r.length-1,insert_before:d,snapshot_id:this.snapshotId},{headers:{Authorization:"Bearer "+this.accessToken}});this.snapshotId=p,r=[...r.slice(0,d),o,...r.slice(d,-1)]}}else lt(r)||await this.quickSort(r,0,r.length-1);this.setIsLoading(!1)}async quickSort(t,e,i){const r=await this.partition(t,e,i);e<r-1&&await this.quickSort(t,e,r-1),r<i&&await this.quickSort(t,r,i)}async partition(t,e,i){const r=t[Math.floor((e+i)/2)];for(;e<=i;){for(;t[e]<r;)e++;for(;t[i]>r;)i--;e<=i&&(await this.swap(t,e,i),e++,i--)}return e}async swap(t,e,i){const r=t[e];t[e]=t[i],t[i]=r;const{data:{snapshot_id:n}}=await f.put(`https://api.spotify.com/v1/playlists/${this.playlist.id}/tracks`,{range_start:e,insert_before:i+1,snapshot_id:this.snapshotId},{headers:{Authorization:"Bearer "+this.accessToken}}),{data:{snapshot_id2:o}}=await f.put(`https://api.spotify.com/v1/playlists/${this.playlist.id}/tracks`,{range_start:i-1>0?i-1:0,insert_before:e,snapshot_id:n},{headers:{Authorization:"Bearer "+this.accessToken}});this.snapshotId=o}}function nt(s){return s.artist+s.releaseDate+s.albumName+s.trackNumber}function L(s){let t=s;return s.toLowerCase().startsWith("a ")?t=s.substring(2):s.toLowerCase().startsWith("the ")?t=s.substring(4):s.startsWith("$")&&(t=s.replace("$","S")),t.toLowerCase()}function lt(s){let t=!0;for(let e=0;e<s.length-1;e++)if(s[e]>s[e+1]){t=!1;break}return t}function ot({playlist:s,accessToken:t,index:e}){var I;const[i,r]=y.exports.useState(!1),[n,o]=y.exports.useState(!1),[d,p]=y.exports.useState(!1),g=()=>{new rt(t,s,p).export().catch(h)},E=()=>{new T(t,s,r).sort(!0).catch(h)},C=()=>{new T(t,s,o).sort(!1).catch(h)};return s.uri==null?c("tr",{className:P(e)?"":"alt-color",children:[a("td",{children:"\xA0"}),a("td",{children:s.name}),a("td",{colSpan:2,children:"This playlist is not supported"}),a("td",{children:"\xA0"}),a("td",{children:"\xA0"})]},s.name):c("tr",{className:P(e)?"":"alt-color",children:[a("td",{children:a("img",{alt:"cover",src:(I=s==null?void 0:s.images)==null?void 0:I[0].url})}),a("td",{className:"align-middle",children:a("a",{href:s.uri,children:s.name})}),a("td",{className:"align-middle",children:s.tracks.total}),a("td",{className:"text-center align-middle",children:c(m,{type:"submit",variant:"primary",onClick:C,className:"text-nowrap text-center button-flex",disabled:N.includes(s.name)||n||i,children:[n?a(w,{}):a(u,{icon:["fas","sort-amount-down-alt"],size:"sm"})," ","Sort Quick"]})}),a("td",{className:"text-center align-middle",children:c(m,{type:"submit",variant:"primary",onClick:E,className:"text-nowrap text-center button-flex",disabled:N.includes(s.name)||i||n,children:[i?a(w,{}):a(u,{icon:["fas","sort-amount-down-alt"],size:"sm"})," ","Sort Last"]})}),a("td",{className:"text-center align-middle",children:c(m,{type:"submit",variant:"primary",onClick:g,className:"text-nowrap text-center button-flex",children:[d?a(w,{}):a(u,{icon:["fas","download"],size:"sm"})," ","Export"]})})]},s.uri)}function w(){return a("div",{className:"loader",children:a("div",{className:"loader__content"})})}function P(s){return s%2==0}const N=["Albums","Anime","Games","Edge 2000","Final Fantasy OST","Release Radar","Solitude bois for lyfe"];function ct({onPageChanged:s,currentPage:t,totalRecords:e,pageLimit:i}){const r=d=>{d.preventDefault(),s(t+1)},n=d=>{d.preventDefault(),s(t-1)},o=()=>Math.ceil(e/i);return a("nav",{className:"paginator text-right",children:c("ul",{className:"pagination pagination-sm",children:[a("li",{className:t<=1?"page-item disabled":"page-item",children:a("a",{className:"page-link",href:"#","aria-label":"Previous",onClick:n,children:a("span",{"aria-hidden":"true",children:"\xAB"})})}),a("li",{className:t>=o()?"page-item disabled":"page-item",children:a("a",{className:"page-link",href:"#","aria-label":"Next",onClick:r,children:a("span",{"aria-hidden":"true",children:"\xBB"})})})]})})}class dt extends K.Component{constructor(){super(...arguments);l(this,"PAGE_SIZE",20);l(this,"userId",null);l(this,"playlistsData",null);l(this,"state",{initialized:!1,searching:!1,playlists:[],playlistCount:0,currentPage:1});l(this,"loadCurrentPlaylistPage",async()=>{try{const t=await this.playlistsData.slice((this.state.currentPage-1)*this.PAGE_SIZE,(this.state.currentPage-1)*this.PAGE_SIZE+this.PAGE_SIZE);this.setState({initialized:!0,searching:!1,playlists:t,playlistCount:await this.playlistsData.total()},()=>{const e=(this.state.currentPage-1)*this.PAGE_SIZE+1,i=Math.min(e+this.PAGE_SIZE-1,this.state.playlistCount);this.setSubtitle(`${e}-${i} of ${this.state.playlistCount} playlists for ${this.userId}`)})}catch(t){h(t)}});l(this,"handlePageChanged",t=>{try{this.setState({currentPage:t},this.loadCurrentPlaylistPage)}catch(e){h(e)}})}setSubtitle(t){const e=document.getElementById("subtitle");e&&(e.textContent=t)}async componentDidMount(){try{const t=await k("https://api.spotify.com/v1/me",this.props.accessToken).then(e=>e.data);this.userId=t.id,this.playlistsData=new st(this.props.accessToken,this.userId),await this.loadCurrentPlaylistPage()}catch(t){h(t)}}render(){return this.state.initialized?c("div",{id:"playlists",children:[c("table",{className:"table table-hover table-sm",children:[a("thead",{children:c("tr",{children:[a("th",{style:{width:"100px"}}),a("th",{children:"Name"}),a("th",{children:"Tracks"}),a("th",{style:{width:"130px"},children:"Actions"}),a("th",{style:{width:"130px"}}),a("th",{style:{width:"130px"}})]})}),a("tbody",{children:this.state.playlists.map((t,e)=>a(ot,{playlist:t,index:e,accessToken:this.props.accessToken},t.id))})]}),a("div",{id:"playlistsFooter",children:a(ct,{currentPage:this.state.currentPage,pageLimit:this.PAGE_SIZE,totalRecords:this.state.playlistCount,onPageChanged:this.handlePageChanged})})]}):a("div",{className:"spinner"})}}function ut(){return a(m,{id:"logoutButton",type:"submit",variant:"link",size:"lg",onClick:()=>{window.location.href=`${window.location.href.split("#")[0]}?change_user=true`},title:"Change user",children:a(u,{icon:["fas","sign-out-alt"],size:"lg"})})}function ht(){return c("div",{id:"spotifyErrorMessage",className:"lead",children:[a("p",{children:a(u,{icon:["fas","bolt"],style:{fontSize:"50px",marginBottom:"20px"}})}),a("p",{children:"Oops, Exportify has encountered an unexpected error (5XX) while using the Spotify API. This kind of error is due to a problem on Spotify's side, and although it's rare, unfortunately all we can do is retry later."}),c("p",{style:{marginTop:"50px"},children:["Keep an eye on the"," ",a("a",{target:"_blank",rel:"noreferrer",href:"https://status.spotify.dev/",children:"Spotify Web API Status page"})," ","to see if there are any known problems right now, and then"," ",a("a",{rel:"noreferrer",href:"?",children:"retry"}),"."]})]})}function pt(){const s=new URLSearchParams(window.location.hash.substring(1));return x("spotify_error")!==""?a(b,{children:a(ht,{})}):s.has("access_token")?a(b,{logoutElement:a(ut,{}),children:a(dt,{accessToken:s.get("access_token")})}):a(b,{children:a(J,{})})}function b({children:s,logoutElement:t=null}){return c("div",{className:"App container",children:[c("header",{className:"App-header",children:[t,c("h1",{children:[a(u,{icon:["fab","spotify"],color:"#84BD00",size:"sm"})," ","Hatlaron's Exportify"]}),a("p",{id:"subtitle",className:"lead text-secondary",children:"Export your Spotify playlists."})]}),s]})}X.render(a(y.exports.StrictMode,{children:a(pt,{})}),document.getElementById("root"));
