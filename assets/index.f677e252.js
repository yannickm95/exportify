import{l as z,f as $,a as B,b as T,c as U,d as F,e as M,g as O,j as u,h as n,F as m,B as h,i as j,k as y,m as q,r as p,R as D}from"./vendor.b5f67df7.js";const W=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}};W();z.add($,B,T,U,F,M,O);const Q=e=>e.replace(/[\x00-\x1F\x7F/\\<>:;"|=,.?*[\] ]+/g,"_").toLowerCase()+".csv";function v(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const t=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=t.exec(window.location.search);return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))}function G(e){let t=!0;for(let r=0;r<e.length-1;r++)if(e[r]>e[r+1]){t=!1;break}return t}function E(e){return e%2==0}function H(e){const t=Math.floor(e/1e3%60);return Math.floor(e/1e3/60).toString()+":"+t.toString().padStart(2,"0")}function V(e){return'"'+String(e).replace(/"/g,'""')+'"'}function X(){return u("div",{id:"spotifyErrorMessage",className:"lead",children:[n("p",{children:n(m,{icon:["fas","bolt"],style:{fontSize:"50px",marginBottom:"20px"}})}),n("p",{children:"Oops, Exportify has encountered an unexpected error (5XX) while using the Spotify API. This kind of error is due to a problem on Spotify's side, and although it's rare, unfortunately all we can do is retry later."}),u("p",{style:{marginTop:"50px"},children:["Keep an eye on the"," ",n("a",{target:"_blank",rel:"noreferrer",href:"https://status.spotify.dev/",children:"Spotify Web API Status page"})," ","to see if there are any known problems right now, and then"," ",n("a",{rel:"noreferrer",href:"?",children:"retry"}),"."]})]})}function K(){return u("form",{className:"login-container",onSubmit:e=>{e.preventDefault(),Y(e)},children:[n("input",{id:"clientId",required:!0,minLength:32,maxLength:32,type:"password",placeholder:"Enter client id..."}),u(h,{type:"submit",variant:"outline-secondary",size:"lg",children:[n(m,{icon:["far","check-circle"],size:"sm"})," Get Started"]})]})}function Y(e){const{clientId:{value:t}}=e.target.elements,r=v("change_user")!=="";window.location.href="https://accounts.spotify.com/authorize?client_id="+t+"&redirect_uri="+encodeURIComponent([window.location.protocol,"//",window.location.host,window.location.pathname].join(""))+"&scope=playlist-read-private%20playlist-read-collaborative%20user-library-read%20playlist-modify-private%20playlist-modify-public&response_type=token&show_dialog="+r}function J(){return n(h,{id:"logoutButton",type:"submit",variant:"link",size:"lg",onClick:()=>{window.location.href=`${window.location.href.split("#")[0]}?change_user=true`},title:"Change user",children:n(m,{icon:["fas","sign-out-alt"],size:"lg"})})}const I=1e3,Z=2,R=new j({maxConcurrent:1,minTime:0}),x=R.wrap(function(e,t){return y.get(e,{headers:{Authorization:"Bearer "+t}})});function g(e){if(e.isAxiosError){if(e.request.status===401){window.location.href=window.location.href.split("#")[0];return}else if(e.request.status>=500&&e.request.status<600){window.location.href=`${window.location.href.split("#")[0]}?spotify_error=true`;return}}throw e}R.on("failed",async(e,t)=>{if(e.response.status===429&&t.retryCount<Z)return(e.response.headers["retry-after"]||1)*1e3+I;if(e.response.status!==401&&e.response.status!==429&&t.retryCount===0)return I});const b=20;async function ee(e,t){const r=async(i,l)=>{const c=`https://api.spotify.com/v1/users/${t}/playlists?offset=${i}&limit=${l-i}`;return(await x(c,e)).data},{items:o,total:s}=await r(0,b);let a=o;for(let i=b;i<s;i=i+b){const{items:l}=await r(i,i+b);a=[...a,...l]}return a}async function _(e,t){const r=[],o=t.tracks.limit||100;for(let i=0;i<t.tracks.total;i=i+o)r.push(`${t.tracks.href.split("?")[0]}?offset=${i}&limit=${o}`);const s=r.map(i=>x(i,e));return(await Promise.all(s)).flatMap(i=>i.data.items.filter(l=>l.track))}function C(e){const t=e.track_number.toString().padStart(2,"0"),r=L(e.artists[0].name),o=L(e.album.name),s=e.album.release_date===null?"0000-00-00":e.album.release_date;return r+s+o+t}function L(e){let t=e;return e.toLowerCase().startsWith("a ")?t=e.substring(2):e.toLowerCase().startsWith("the ")?t=e.substring(4):e.startsWith("$")&&(t=e.replace("$","S")),t.toLowerCase()}async function te(e,t){async function r(i,l,c){const d=[...i],f=await o(d,l,c);l<f-1&&await r(d,l,f-1),f<c&&await r(d,f,c)}async function o(i,l,c){const d=i[Math.floor((l+c)/2)];for(;l<=c;){for(;i[l]<d;)l++;for(;i[c]>d;)c--;l<=c&&(await s(i,l,c),l++,c--)}return l}async function s(i,l,c){const d=i[l];i[l]=i[c],i[c]=d,await y.put(`https://api.spotify.com/v1/playlists/${t.id}/tracks`,{range_start:l,insert_before:c+1},{headers:{Authorization:"Bearer "+e}}),await y.put(`https://api.spotify.com/v1/playlists/${t.id}/tracks`,{range_start:c-1>0?c-1:0,insert_before:l},{headers:{Authorization:"Bearer "+e}})}const a=await _(e,t).then(i=>i.map(({track:l})=>C(l)));G(a)||await r(a,0,a.length-1)}async function ne(e,t){let r=await _(e,t).then(s=>s.map(({track:a})=>C(a)));const o=[];for(let s=r.length-1;s>0;s--){const a=r[s];if(r.slice(s-100>0?s-100:0,s).some(i=>a<i))o.push(a);else break}if(o.length===0)return 0;for(const s of o){const a=r.findIndex(i=>i>s);await y.put(`https://api.spotify.com/v1/playlists/${t.id}/tracks`,{range_start:r.length-1,insert_before:a},{headers:{Authorization:"Bearer "+e}}),r=[...r.slice(0,a),s,...r.slice(a,-1)]}return o.length}function re(e){return[["Track URI","Track Name","Artist Name(s)","Album Name","Album Artist Name(s)","Album Release Date","Album Image URL","Album URI","Disc Number","Track Number","Track Duration (ms)"],...se(e).filter(r=>r.uri).map(r=>r.item)].map(r=>r.map(V).join(",")+`
`).join("")}function se(e){return e.map(({track:t})=>({uri:t.uri,item:[t.uri.startsWith("spotify:local")?decodeURIComponent(t.uri.replaceAll("+"," ")):t.uri,t.name,t.artists.map(r=>String(r.name).replace(/,/g,"\\,")).join(", "),t.album.name,t.album.artists.map(r=>String(r.name).replace(/,/g,"\\,")).join(", "),t.album.release_date==null?"":t.album.release_date,t.album.images[0]==null?"":t.album.images[0].url,t.album.uri==null?"":t.album.uri,t.disc_number,t.track_number,H(t.duration_ms)]}))}async function ie(e,t){const r=await _(e,t),o=new Blob([re(r)],{type:"text/csv;charset=utf-8"});q.exports.saveAs(o,Q(t.name))}function S(){return n("div",{className:"loader",children:n("div",{className:"loader__content"})})}const k="Albums,Anime,Games,Edge_2000,Final_Fantasy_OST,Release_Radar,Solitude_bois_for_lyfe".replaceAll("_"," ").split(",")||[];function ae({playlist:e,accessToken:t,index:r}){var N;const[o,s]=p.exports.useState(!1),a=async()=>{s(!0),te(t,e).catch(g).finally(()=>s(!1))},[i,l]=p.exports.useState(!1),c=async()=>{l(!0),ne(t,e).catch(g).finally(()=>l(!1))},[d,f]=p.exports.useState(!1),P=()=>{f(!0),ie(t,e).catch(g).finally(()=>f(!1))},w=d||o||i;return e.uri==null?u("tr",{className:E(r)?"":"alt-color",children:[n("td",{children:"\xA0"}),n("td",{children:e.name}),n("td",{colSpan:2,children:"This playlist is not supported"}),n("td",{children:"\xA0"}),n("td",{children:"\xA0"})]},e.name):u("tr",{className:E(r)?"":"alt-color",children:[n("td",{children:n("img",{alt:"cover",src:(N=e==null?void 0:e.images)==null?void 0:N[0].url})}),n("td",{className:"align-middle",children:n("a",{href:e.uri,children:e.name})}),n("td",{className:"align-middle",children:e.tracks.total}),n("td",{className:"text-center align-middle",children:k.includes(e.name)?null:u(h,{type:"submit",variant:"primary",onClick:a,className:"text-nowrap text-center button-flex",disabled:w,children:[o?n(S,{}):n(m,{icon:["fas","sort"],size:"sm"})," ","Quicksort"]})}),n("td",{className:"text-center align-middle",children:k.includes(e.name)?null:u(h,{type:"submit",variant:"primary",onClick:c,className:"text-nowrap text-center button-flex",disabled:w,children:[i?n(S,{}):n(m,{icon:["fas","sort-amount-up-alt"],size:"sm"})," ","Sort Last"]})}),n("td",{className:"text-center align-middle",children:u(h,{type:"submit",variant:"primary",onClick:P,className:"text-nowrap text-center button-flex",disabled:w,children:[d?n(S,{}):n(m,{icon:["fas","download"],size:"sm"})," ","Export"]})})]},e.uri)}function oe({accessToken:e}){const[t,r]=p.exports.useState(void 0);return p.exports.useEffect(()=>{(async function(){try{const{data:o}=await x("https://api.spotify.com/v1/me",e),s=await ee(e,o.id),a=document.getElementById("subtitle");r(s),a.textContent=`${s.length} playlists for ${o.id}`}catch(o){g(o)}})()},[e]),t?n("div",{id:"playlists",children:u("table",{className:"table table-hover table-sm",children:[n("thead",{children:u("tr",{children:[n("th",{style:{width:"100px"}}),n("th",{children:"Name"}),n("th",{children:"Tracks"}),n("th",{style:{width:"130px"}}),n("th",{style:{width:"130px"}}),n("th",{style:{width:"130px",textAlign:"right",paddingRight:"15px"},children:"Actions"})]})}),n("tbody",{children:t.map((o,s)=>n(ae,{playlist:o,index:s,accessToken:e},o.id))})]})}):n("div",{className:"spinner"})}function A({children:e,logoutElement:t=null}){return u("div",{className:"App container",children:[u("header",{className:"App-header",children:[t,u("h1",{children:[n(m,{icon:["fab","spotify"],color:"#1ed760",size:"sm"})," ","Hatlaron's Exportify"]}),n("p",{id:"subtitle",className:"lead text-secondary",children:"Export your Spotify playlists."})]}),e]})}function le(){const e=new URLSearchParams(window.location.hash.substring(1));return v("spotify_error")!==""?n(A,{children:n(X,{})}):e.has("access_token")?n(A,{logoutElement:n(J,{}),children:n(oe,{accessToken:e.get("access_token")})}):n(A,{children:n(K,{})})}D.render(n(p.exports.StrictMode,{children:n(le,{})}),document.getElementById("root"));
